<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RouteCoinMe - GPS Route Aggregation & 3D Visualization</title>
    <meta name="description" content="Aggregate GPS routes from Strava and visualize cumulative climbing in 3D">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body>
    <input type="file" id="gpx-file-input" class="visually-hidden-input" accept=".gpx,.xml" multiple>
    <div id="app">
        <header class="header">
            <div class="container">
                <h1 class="logo">RouteCoinMe</h1>
                <button id="nav-toggle" class="nav-toggle" type="button" aria-controls="primary-nav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="nav-toggle-bar"></span>
                    <span class="nav-toggle-bar"></span>
                    <span class="nav-toggle-bar"></span>
                </button>
                <nav id="primary-nav" class="nav">
                    <button id="unit-toggle-btn" class="btn btn-secondary" type="button">Use miles + feet</button>
                    <button id="auth-btn" class="btn btn-primary">Connect with Strava</button>
                </nav>
            </div>
        </header>

        <main class="main">
            <div class="container">
                <section class="hero">
                    <h2>Create Your Route Coins</h2>
                    <p>Transform your GPS routes into stunning 3D visualizations. Choose a coin type to get started:</p>
                    <div class="feature-grid">
                        <button class="feature-button" id="route-coin-btn" type="button">
                            <div class="feature-icon">ü™ô</div>
                            <h3>Route Coin</h3>
                            <p>Visualize a single Strava Activity or GPX upload</p>
                        </button>
                        <button class="feature-button feature-button-disabled" id="segment-coin-btn" type="button" disabled>
                            <div class="feature-icon">üèÜ</div>
                            <h3>Segment Coin</h3>
                            <p>Show a KOM/QOM segment from Strava</p>
                            <span class="feature-badge">Requires Strava</span>
                        </button>
                        <button class="feature-button feature-button-disabled" id="year-coin-btn" type="button" disabled>
                            <div class="feature-icon">üìÖ</div>
                            <h3>2025 Route Coin</h3>
                            <p>Combine all your 2025 cycling activities into one coin</p>
                            <span class="feature-badge">Requires Strava</span>
                        </button>
                        <button class="feature-button" id="designer-coin-btn" type="button">
                            <div class="feature-icon">üé®</div>
                            <h3>Coin Designer</h3>
                            <p>Advanced coin creation with route merging and overlays</p>
                        </button>
                    </div>
                </section>

                <section class="demo-area">
                    <div id="demo-placeholder" class="demo-placeholder">
                        <!-- Landing State UI -->
                        <div id="landing-state" class="landing-state">
                            <h3>3D Route Visualization</h3>
                            <p>Your aggregated routes will appear here in interactive 3D</p>
                            <div class="placeholder-chart">
                                <div class="chart-line"></div>
                                <div class="chart-line"></div>
                                <div class="chart-line"></div>
                            </div>
                            <button id="landing-upload-btn" class="btn btn-primary" onclick="window.fileUploader?.showFileUploadUI()">
                                üìÅ Upload GPX Files to Get Started
                            </button>
                        </div>

                        <!-- File Upload UI -->
                        <div id="file-upload-section" class="file-upload-section" style="display: none;">
                            <label for="gpx-file-input" id="upload-area" class="upload-area">
                                <div class="upload-content">
                                    <div class="upload-icon">üìÅ</div>
                                    <h3>Drop GPX files here or tap to browse</h3>
                                    <p>Upload your GPX route files to get started</p>
                                </div>
                            </label>
                        </div>

        <!-- Route Visualization UI -->
        <div id="route-visualization-area" class="gpx-upload-area" style="display: none;">

            <!-- Loading State -->
            <div id="loading-state" class="loading-section" style="display: none;">
                <h3>ÔøΩ Processing GPX Files...</h3>
                <p>Parsing GPS data and calculating route statistics</p>
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
            </div>

            <!-- Main Content (hidden during loading) -->
            <div id="main-content">
                <div class="aggregation-layout">
                    <!-- Full Width Header -->
                    <div class="visualization-header">
                        <h3>üìä GPX Routes Loaded</h3>
                        <div class="visualization-header-actions">
                            <button id="sidebar-toggle" class="sidebar-toggle-btn" type="button" aria-controls="aggregation-sidebar" aria-expanded="false">
                                ‚öôÔ∏è Coin Controls
                            </button>
                        </div>
                    </div>

                    <!-- Upload Actions -->
                    <div id="upload-actions" class="upload-actions">
                        <label for="gpx-file-input" id="upload-more-btn" class="btn btn-primary">
                            üìÅ Upload More GPX Files
                        </label>
                        <button id="clear-all-btn" class="btn btn-secondary" onclick="window.fileUploader.clearAllRoutes()">
                            üóëÔ∏è Clear All Routes
                        </button>
                    </div>

                    <!-- Full Width Route Statistics -->
                    <div class="route-stats">
                        <div class="stat-item">
                            <span id="stat-routes-count" class="stat-number">0</span>
                            <span class="stat-label">Routes</span>
                        </div>
                        <div class="stat-item">
                            <span id="stat-total-distance" class="stat-number">0.0km</span>
                            <span class="stat-label">Total Distance</span>
                        </div>
                        <div class="stat-item">
                            <span id="stat-total-elevation" class="stat-number">0m</span>
                            <span class="stat-label">Total Elevation</span>
                        </div>
                    </div>

                    <!-- Viewer and Sidebar Row -->
                    <div class="viewer-sidebar-row">
                        <div class="viewer-column">
                            <!-- Map Container -->
                            <div id="map-container" class="map-container" style="display: block;">
                                <div id="route-map"></div>
                                <div class="map-controls">
                                    <button id="map-fullscreen-btn" class="map-control-btn" onclick="window.fileUploader.toggleFullscreen()" title="Toggle Fullscreen">
                                        üìê
                                    </button>
                                    <button id="map-fit-btn" class="map-control-btn" onclick="window.fileUploader.fitMapToRoutes()" title="Fit All Routes">
                                        üîç
                                    </button>
                                </div>
                            </div>

                            <!-- View Coin Container -->
                            <div id="viewer-3d-container" class="viewer-3d-container" style="display: none;">
                                <div id="route-3d-viewer" style="width: 100%; height: 100%; position: relative;"></div>

                                <!-- Zoom Controls - Top Left -->
                                <div class="control-overlay control-top-left">
                                    <button id="3d-zoom-in-btn" class="control-btn" onclick="window.fileUploader.zoomIn3D()" title="Zoom In">+</button>
                                    <button id="3d-zoom-out-btn" class="control-btn" onclick="window.fileUploader.zoomOut3D()" title="Zoom Out">‚àí</button>
                                </div>

                                <!-- View Controls - Top Right -->
                                <div class="control-overlay control-top-right">
                                    <button id="3d-fit-view-btn" class="control-btn" onclick="window.fileUploader.fitToView3D()" title="Fit to View">‚ñ≥</button>
                                </div>

                                <div id="viewer-3d-status" class="viewer-3d-status">
                                    <span>Left: rotate ‚Ä¢ Right: pan ‚Ä¢ Wheel: zoom</span>
                                </div>
                            </div>
                        </div>

                        <aside id="aggregation-sidebar" class="aggregation-sidebar" aria-hidden="false">
                        <button id="sidebar-close-btn" class="sidebar-close-btn" type="button" aria-label="Close coin controls">√ó</button>
                        <h4>Coin Controls</h4>

                        <div class="toggle-group">
                            <button id="map-view-btn" class="toggle-btn active" type="button">üó∫Ô∏è Map</button>
                            <button id="view-coin-btn" class="toggle-btn" type="button">ü™ô Coin</button>
                        </div>

                        <div class="sidebar-group">
                            <span class="group-label">Elevation Mode</span>
                            <div class="toggle-group">
                                <input type="radio" name="elevation-mode" id="elevation-mode-actual" value="actual" class="toggle-input" checked>
                                <label for="elevation-mode-actual" class="toggle-btn active">Actual</label>
                                <input type="radio" name="elevation-mode" id="elevation-mode-cumulative" value="cumulative" class="toggle-input">
                                <label for="elevation-mode-cumulative" class="toggle-btn">Cumulative</label>
                            </div>
                        </div>

                        <div class="sidebar-group">
                            <label for="overlay-select" class="group-label">Overlay</label>
                            <select id="overlay-select" class="sidebar-select">
                                <option value="real">Real Route</option>
                                <option value="spiral.json">Spiral Overlay</option>
                                <option value="semi-circle.json">Semi-Circle Overlay</option>
                                <option value="switchbacks.json">Switchbacks Overlay</option>
                                <option value="sa-calobra.json">Sa Calobra Overlay</option>
                                <option value="stelvio.json">Stelvio Pass Overlay</option>
                            </select>
                        </div>

                        <div class="sidebar-group" id="distribution-group" style="display: none;">
                            <span class="group-label">Distribution</span>
                            <div class="toggle-group">
                                <input type="radio" name="aggregation-domain" id="domain-distance" value="distance" class="toggle-input" checked>
                                <label for="domain-distance" class="toggle-btn active">Distance</label>
                                <input type="radio" name="aggregation-domain" id="domain-time" value="time" class="toggle-input">
                                <label for="domain-time" class="toggle-btn">Time</label>
                            </div>
                        </div>

                        <div class="sidebar-group" id="stl-settings-group">
                            <span class="group-label">Coin Settings</span>

                            <div class="form-group">
                                <div class="form-group-inline">
                                    <label for="stl-diameter-input" class="form-label">
                                        Diameter <span class="form-label-unit">(cm)</span>
                                    </label>
                                    <input type="number" id="stl-diameter-input" class="form-input form-input-compact" min="3" max="20" step="0.5" value="8">
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-group-inline">
                                    <label for="stl-elevation-height-input" class="form-label">
                                        Elevation Height <span class="form-label-unit">(mm)</span>
                                    </label>
                                    <input type="number" id="stl-elevation-height-input" class="form-input form-input-compact" min="5" max="60" step="5" value="20">
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-group-inline">
                                    <label for="stl-route-thickness-input" class="form-label">
                                        Route Thickness <span class="form-label-unit">(mm)</span>
                                    </label>
                                    <input type="number" id="stl-route-thickness-input" class="form-input form-input-compact" min="0.5" max="3" step="0.1" value="1">
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-group-inline">
                                    <label for="stl-edge-margin-input" class="form-label">
                                        Edge Margin <span class="form-label-unit">(mm)</span>
                                    </label>
                                    <input type="number" id="stl-edge-margin-input" class="form-input form-input-compact" min="0" max="5" step="0.5" value="1">
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-group-inline">
                                    <label for="stl-min-path-height-input" class="form-label">
                                        Min Path Height <span class="form-label-unit">(mm)</span>
                                    </label>
                                    <input type="number" id="stl-min-path-height-input" class="form-input form-input-compact" min="0" max="10" step="0.1" value="1">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-option">
                                    <input type="checkbox" id="stl-include-base" checked>
                                    <span>Include base plate</span>
                                </label>
                            </div>
                        </div>

                        <div class="sidebar-actions">
                            <button id="save-coin-btn" class="btn btn-primary" type="button" disabled>üíæ Save Coin</button>
                            <button id="download-coin-btn" class="btn btn-secondary" type="button" disabled>‚¨áÔ∏è Download Coin GPX</button>
                            <button id="download-stl-btn" class="btn btn-secondary" type="button" disabled>üñ®Ô∏è Download STL</button>
                        </div>
                    </aside>
                    </div>  <!-- End viewer-sidebar-row -->

                    <!-- Full Width Routes & Coins Lists -->
                    <div class="list-tabs" id="list-tabs">
                        <div class="tab-buttons" role="tablist" aria-label="Routes and saved coins">
                            <button id="routes-tab-btn" class="tab-button active" type="button" role="tab" aria-selected="true" aria-controls="routes-tab-panel" data-target="routes">
                                Routes
                            </button>
                            <button id="coins-tab-btn" class="tab-button tab-button-coins" type="button" role="tab" aria-selected="false" aria-controls="coins-tab-panel" data-target="coins">
                                üí∞ Saved Coins
                            </button>
                        </div>
                        <div id="routes-tab-panel" class="tab-panel active" role="tabpanel" aria-labelledby="routes-tab-btn">
                            <div id="route-list" class="list-panel"></div>
                        </div>
                        <div id="coins-tab-panel" class="tab-panel" role="tabpanel" aria-labelledby="coins-tab-btn" aria-hidden="true">
                            <div id="coin-list" class="list-panel"></div>
                        </div>
                    </div>

                    <!-- Full Width Drop Zone Hint -->
                    <div id="drop-zone-hint" class="drop-zone-hint">
                        <p>üí° Tip: You can also drag & drop GPX files anywhere on this page</p>
                    </div>

                    <div id="sidebar-overlay" class="sidebar-overlay" hidden></div>
                </div>  <!-- End aggregation-layout -->
            </div>  <!-- End main-content -->
        </div>  <!-- End route-visualization-area -->
                    </div>
                </section>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p>&copy; 2025 RouteCoinMe. Built with privacy in mind.</p>
                <div class="footer-links">
                    <a href="/privacy/">Privacy Policy</a>
                    <a href="/terms/">Terms of Service</a>
                    <a href="https://github.com/bsyk/routecoinme" target="_blank">GitHub</a>
                    <a href="https://github.com/bsyk/routecoinme/issues" target="_blank" rel="noopener">Support</a>
                </div>
            </div>
        </footer>
    </div>

    <script type="module" src="/src/main.js"></script>
</body>
</html>
